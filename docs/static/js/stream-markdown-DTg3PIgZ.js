const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./shiki-Cjr4Ny_r.js","./@mermaid-js-BAp2aObr.js","./langium-DJMK8hyp.js","./vscode-jsonrpc-CNa_m3dn.js","./chevrotain-BCfWnvdc.js","./@chevrotain-B9w1F9z3.js","./lodash-es-0h6_uya3.js","./chevrotain-allstar-DPtXl-ZX.js","./vscode-languageserver-types-NoPvPymt.js","./vscode-languageserver-textdocument-CKBVUiR3.js","./vscode-uri-DEqhlMU_.js","./@shikijs--vdTbfoK.js","./hast-util-to-html-BJMNxv-u.js","./html-void-elements-CkdplsNl.js","./property-information-rJCbAzvX.js","./zwitch-C2o2j-tx.js","./stringify-entities-CnbJBXhi.js","./character-entities-legacy-BpoLgcEt.js","./character-entities-html4-D7taRCQ7.js","./ccount-c2V3InAJ.js","./comma-separated-tokens-D8TqSuIK.js","./space-separated-tokens-DD3iYX1K.js","./hast-util-whitespace-D4Wp6AEg.js"])))=>i.map(i=>d[i]);
import{_ as V}from"./@mermaid-js-BAp2aObr.js";import"./langium-DJMK8hyp.js";import"./vscode-jsonrpc-CNa_m3dn.js";import"./chevrotain-BCfWnvdc.js";import"./@chevrotain-B9w1F9z3.js";import"./lodash-es-0h6_uya3.js";import"./chevrotain-allstar-DPtXl-ZX.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./vscode-uri-DEqhlMU_.js";const z=["jsx","tsx","vue","csharp","python","java","c","cpp","rust","go","powershell","sql","json","html","javascript","typescript","css","markdown","xml","yaml","toml","dockerfile","kotlin","objective-c","objective-cpp","php","ruby","scala","svelte","swift","erlang","angular-html","angular-ts","dart","lua","mermaid","cmake","nginx"],G=["vitesse-dark","vitesse-light"];let I=null,q=null;async function J(e={}){return I||(q||(q=(async()=>{const{createHighlighter:t}=await V(async()=>{const{createHighlighter:n}=await import("./shiki-Cjr4Ny_r.js");return{createHighlighter:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url);(!e.langs||e.langs.length===0)&&(e.langs=z),(!e.themes||e.themes.length===0)&&(e.themes=G);const r=await t({themes:e.themes,langs:e.langs});return I=r,r})().finally(()=>{q=null})),await q,I)}function ye(){I=null}function Q(e){return e.replace(/\r/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function K(e){if(!e||e===0)return"";const t=[];return e&1&&t.push("font-style: italic;"),e&2&&t.push("font-weight: 600;"),e&4&&t.push("text-decoration: underline; text-underline-offset: 0.15em;"),t.join(" ")}function F(e,t,r){var b,p;const{lang:n,theme:s,preClass:o="shiki",codeClass:l="",lineClass:f="line",showLineNumbers:c=!1,startingLineNumber:a=1}=r;let u;const i=e;if(typeof i.codeToThemedTokens=="function")u=i.codeToThemedTokens(t,n,s);else if(typeof i.codeToTokens=="function")u=i.codeToTokens(t,{lang:n,theme:s}).tokens;else throw new TypeError("Highlighter does not support token APIs: codeToThemedTokens/codeToTokens");{const g=t.replace(/\r\n/g,`
`).split(`
`).length;u.length<g&&(u=u.concat(Array.from({length:g-u.length},()=>[])))}let h;try{h=(p=(b=e.getTheme)==null?void 0:b.call(e,s))==null?void 0:p.bg}catch{}let C=a;const m=u.map(g=>{const R=g.map(v=>{const x=`${v.color?`color: ${v.color};`:""}${K(v.fontStyle)}`;return`<span${x?` style="${x}"`:""}>${Q(v.content)}</span>`}).join("");return`<span class="${f}">${c?`<span class="line-number" data-line="${C++}"></span>`:""}${R}</span>`}).join(`
`);return`<pre class="${o}"${h?` style="background-color: ${h};"`:""}><code${l?` class="${l}"`:""}>${m}</code></pre>`}function X(e){const t=e;if(typeof t.codeToThemedTokens=="function")return(r,n,s)=>t.codeToThemedTokens(r,n,s);if(typeof t.codeToTokens=="function")return(r,n,s)=>t.codeToTokens(r,{lang:n,theme:s}).tokens;throw new Error("Highlighter does not support token APIs: codeToThemedTokens/codeToTokens")}function P(e){if(!e||e===0)return"";const t=[];return e&1&&t.push("font-style: italic;"),e&2&&t.push("font-weight: 600;"),e&4&&t.push("text-decoration: underline; text-underline-offset: 0.15em;"),t.join(" ")}function Y(e){return e.replace(/\r/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Z(e,t,r){const n=e.map(s=>{const o=`${s.color?`color: ${s.color};`:""}${P(s.fontStyle)}`;return`<span${o?` style="${o}"`:""}>${Y(s.content)}</span>`}).join("");return`${t&&typeof r=="number"?`<span class="line-number" data-line="${r}"></span>`:""}${n}`}function A(e,t,r,n){const s=document.createElement("span");if(s.className=n,t&&typeof r=="number"){const l=document.createElement("span");l.className="line-number",l.dataset.line=String(r),s.appendChild(l)}let o=0;for(;o<e.length;){const l=e[o],f=`${l.color?`color: ${l.color};`:""}${P(l.fontStyle)}`;let c=l.content;for(o++;o<e.length;){const u=e[o];if(`${u.color?`color: ${u.color};`:""}${P(u.fontStyle)}`!==f)break;c+=u.content,o++}const a=document.createElement("span");f&&a.setAttribute("style",f),a.textContent=c,s.appendChild(a)}return s}function W(e,t,r,n){var x,T,S,$,N;if(!e)return"noop";const{lang:s,theme:o,preClass:l="shiki",codeClass:f="",lineClass:c="line",showLineNumbers:a=!1,startingLineNumber:u=1}=n,i=X(t),h=e.querySelector("code");if(!h)return e.innerHTML=F(t,r,{lang:s,theme:o,preClass:l,codeClass:f,lineClass:c,showLineNumbers:a,startingLineNumber:u}),(x=n.onResult)==null||x.call(n,"full"),"full";const C=h.querySelectorAll(`.${c}`);let m=i(r,s,o);{const d=r.replace(/\r\n/g,`
`).split(`
`).length;if(m.length<d){const k=d-m.length;m=m.concat(Array.from({length:k},()=>[]))}}const b=m.length,p=C.length;let g=-1;const R=Math.min(p,b);let v=u;for(let d=0;d<R;d++){const k=Z(m[d],a,a?v:void 0);if(C[d].innerHTML!==k){g=d;break}v++}if(g===-1){if(b>p){const d=document.createDocumentFragment();let k=u+p;for(let L=p;L<b;L++){d.appendChild(document.createTextNode(`
`));const H=A(m[L],a,a?k:void 0,c);d.appendChild(H),k++}return h.appendChild(d),(T=n.onResult)==null||T.call(n,"incremental"),"incremental"}return(S=n.onResult)==null||S.call(n,"noop"),"noop"}if(g>=p-1){const d=A(m[g],a,a?u+g:void 0,c);for(C[g].innerHTML="";d.firstChild;)C[g].appendChild(d.firstChild);if(b>p){const k=document.createDocumentFragment();let L=u+p;for(let H=p;H<b;H++){k.appendChild(document.createTextNode(`
`));const D=A(m[H],a,a?L:void 0,c);k.appendChild(D),L++}h.appendChild(k)}return($=n.onResult)==null||$.call(n,"incremental"),"incremental"}return e.innerHTML=F(t,r,{lang:s,theme:o,preClass:l,codeClass:f,lineClass:c,showLineNumbers:a,startingLineNumber:u}),(N=n.onResult)==null||N.call(n,"full"),"full"}function ke(e,t,r){let n=!0,s=e;return{update:o=>!n||!s?"noop":W(s,t,o,r),reset:()=>{!n||!s||(s.innerHTML="")},dispose:()=>{n=!1,s=null}}}var ee=class{constructor(){this.queue=[],this.byContainer=new WeakMap,this.visible=new WeakMap,this.io=null,this.handle=null,this.nextId=1;try{this.io=new IntersectionObserver(e=>{for(const t of e)this.visible.set(t.target,t.isIntersecting)},{root:null,threshold:0})}catch{this.io=null}}schedule(e,t,r,n){var l;const s=this.byContainer.get(e);if(s)return s.code=r,s.highlighter=t,s.opts=n,s.id;const o={id:this.nextId++,container:e,highlighter:t,code:r,opts:n};{const f=r.replace(/\r\n/g,`
`),c=1+(((l=f.match(/\n/g))==null?void 0:l.length)??0),a=Math.ceil(f.length/6);o.estNodes=Math.min(8e3,c+a)}return this.queue.push(o),this.byContainer.set(e,o),this.io&&this.io.observe(e),this.ensureProcessing(),o.id}ensureProcessing(){this.handle==null&&(this.handle=(window.requestIdleCallback||function(e){return setTimeout(()=>e({timeRemaining:()=>50,didTimeout:!0}),50)})(e=>this.process(e)))}process(e){var s,o,l,f,c,a;this.handle=null;const t=typeof(e==null?void 0:e.timeRemaining)=="function"?e.timeRemaining():50,r=Math.min(2e3,Math.max(100,Math.floor(t*6)));let n=0;for(;this.queue.length&&!(n>=r);){let u=this.queue.findIndex(h=>this.visible.get(h.container)===!0);u===-1&&(u=0);const i=this.queue.splice(u,1)[0];if(this.byContainer.delete(i.container),typeof i.estNodes=="number"&&n+i.estNodes>r&&n!==0){this.queue.push(i),this.byContainer.set(i.container,i);break}try{const h=W(i.container,i.highlighter,i.code,i.opts);(o=(s=i.opts).onResult)==null||o.call(s,h),typeof i.estNodes=="number"?n+=i.estNodes:n+=50}catch{try{i.container.innerHTML=F(i.highlighter,i.code,{lang:i.opts.lang,theme:i.opts.theme,preClass:i.opts.preClass,codeClass:i.opts.codeClass,lineClass:i.opts.lineClass,showLineNumbers:i.opts.showLineNumbers,startingLineNumber:i.opts.startingLineNumber}),(f=(l=i.opts).onResult)==null||f.call(l,"full")}catch{(a=(c=i.opts).onResult)==null||a.call(c,"noop")}}if(typeof(e==null?void 0:e.timeRemaining)=="function"&&e.timeRemaining()<6)break}this.queue.length&&this.ensureProcessing()}cancelFor(e){const t=this.byContainer.get(e);if(!t)return;this.byContainer.delete(e);const r=this.queue.findIndex(n=>n.id===t.id);r!==-1&&this.queue.splice(r,1),this.io&&this.io.unobserve(e),this.visible.delete(e)}};const E=new ee;function te(e,t,r){let n=!0,s=!1;return{update:o=>(!n||!e||(E.schedule(e,t,o,r),s=!0),"noop"),reset:()=>{!n||!e||(E.cancelFor(e),e.innerHTML="")},dispose:()=>{n=!1,s&&e&&E.cancelFor(e)}}}const y=[];let w=null,M=!1,O=8;function ne(e){typeof e=="number"&&e>=0&&(O=e)}function we(){return O}function Ce(){return M}function ve(){return y.length}function re(){M=!0}function se(){M&&(M=!1,U())}function U(){w==null&&(M||(w=requestAnimationFrame(ie)))}function ie(){w=null;const e=performance.now();for(;y.length>0;){const t=y.shift();try{t()}catch(r){console.error("render-scheduler job error",r)}if(performance.now()-e>=O)break}y.length>0&&U()}function _(e,t){((t==null?void 0:t.priority)??"normal")==="high"?y.unshift(e):y.push(e),U();let r=!1;return()=>{if(r)return;r=!0;const n=y.indexOf(e);n>=0&&y.splice(n,1)}}function xe(e){e()}function oe(){for(w!=null&&(cancelAnimationFrame(w),w=null);y.length>0;){const e=y.shift();try{e()}catch{}}}function Le(){y.length=0,w!=null&&(cancelAnimationFrame(w),w=null)}function $e(e,t={}){const r=Math.max(1,t.batchSize??6),n=Math.max(1,t.staggerMs??30),s=[],o=[];for(const c of e){const a=c.el.getBoundingClientRect(),u=globalThis.innerHeight??0;a.bottom>=0&&a.top<=u?s.push(c):o.push(c)}re();for(const c of s)_(()=>{try{c.render()}catch{}},{priority:"high"});se(),t.drainVisible&&oe();let l=!1;const f=[];for(let c=0;c<o.length;c+=r){const a=o.slice(c,c+r),u=Math.floor(c/r)*n,i=setTimeout(()=>{if(!l)for(const h of a)_(()=>{try{h.render()}catch{}},{priority:"normal"})},u);f.push(i)}return()=>{l=!0;for(const c of f)clearTimeout(c)}}const B=new WeakMap;let j=null;function le(){return j||(typeof window>"u"||!window.IntersectionObserver?null:(j=new IntersectionObserver(e=>{for(const t of e){const r=B.get(t.target);if(r)try{r(!!t.isIntersecting,t)}catch{}}},{root:null,threshold:0}),j))}function ce(e,t){const r=le();return B.set(e,t),r&&r.observe(e),()=>{B.delete(e),r&&r.unobserve(e)}}function He(e,t){let r="",n=t.lang,s=t.theme??"vitesse-dark",o=null,l=null;const f=t.scheduleInRaf??!0;let c=!1,a=null,u=!1,i=null,h=!1;const C=()=>{a!=null&&(cancelAnimationFrame(a),a=null)},m=async()=>{o=await J({langs:t.langs,themes:t.themes})};typeof window<"u"&&e&&(i=ce(e,T=>{h=T})),typeof t.timeBudget=="number"&&t.timeBudget>=0&&ne(t.timeBudget);const b=()=>{l==null||l.dispose(),l=te(e,o,{lang:n??"plaintext",theme:s})},p=()=>{if(!u&&!c){if(!f){if(!l)return;l.update(r);return}c||(c=!0,_(()=>{c=!1,l&&l.update(r)},{priority:h?"high":"normal"}),a=null)}};return{updateCode:async(T,S)=>{const $=S??n,N=$!==n;r=T,!o||N?(n=$,await m(),b()):l||b(),p()},setTheme:async T=>{T&&T!==s&&(s=T,o?o.loadTheme(T):await m(),b(),p())},dispose:()=>{l==null||l.dispose(),l=null,i&&(i(),i=null),u=!0,C()},getState:()=>({code:r,lang:n,theme:s})}}export{Le as clearAll,te as createScheduledTokenIncrementalUpdater,He as createShikiStreamRenderer,ke as createTokenIncrementalUpdater,z as defaultLanguages,G as defaultThemes,ye as disposeHighlighter,oe as drain,ve as getQueueLength,we as getTimeBudget,Ce as isPaused,re as pause,J as registerHighlight,F as renderCodeWithTokens,$e as restoreWithVisibilityPriority,se as resume,xe as runImmediate,_ as scheduleRenderJob,ne as setTimeBudget,W as updateCodeTokensIncremental};
