var tt=Object.defineProperty;var it=(e,t,i)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var g=(e,t,i)=>it(e,typeof t!="symbol"?t+"":t,i);import{_ as Ie}from"./monaco-editor-CR4N2Uva.js";import{s as lt,c as ot,e as nt}from"./alien-signals-WsNVeHi5.js";import{F as rt}from"./@shikijs--vdTbfoK.js";import{createHighlighter as Se}from"./shiki-Cjr4Ny_r.js";import"./@mermaid-js-BAp2aObr.js";import"./langium-DJMK8hyp.js";import"./vscode-jsonrpc-CNa_m3dn.js";import"./chevrotain-BCfWnvdc.js";import"./@chevrotain-B9w1F9z3.js";import"./lodash-es-0h6_uya3.js";import"./chevrotain-allstar-DPtXl-ZX.js";import"./vscode-languageserver-types-NoPvPymt.js";import"./vscode-languageserver-textdocument-CKBVUiR3.js";import"./vscode-uri-DEqhlMU_.js";import"./hast-util-to-html-BJMNxv-u.js";import"./html-void-elements-CkdplsNl.js";import"./property-information-rJCbAzvX.js";import"./zwitch-C2o2j-tx.js";import"./stringify-entities-CnbJBXhi.js";import"./character-entities-legacy-BpoLgcEt.js";import"./character-entities-html4-D7taRCQ7.js";import"./ccount-c2V3InAJ.js";import"./comma-separated-tokens-D8TqSuIK.js";import"./space-separated-tokens-DD3iYX1K.js";import"./hast-util-whitespace-D4Wp6AEg.js";var He=Object.defineProperty,st=Object.getOwnPropertyDescriptor,at=Object.getOwnPropertyNames,dt=Object.prototype.hasOwnProperty,ht=(e,t)=>{for(var i in t)He(e,i,{get:t[i],enumerable:!0})},ct=(e,t,i,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(var o=at(t),n=0,r=o.length,s;n<r;n++)s=o[n],!dt.call(e,s)&&s!==i&&He(e,s,{get:(a=>t[a]).bind(null,s),enumerable:!(l=st(t,s))||l.enumerable});return e},ft=(e,t,i)=>(ct(e,t,"default"),i);const Me=[["bash",[/#!(\/usr)?\/bin\/bash/g,500],[/\b(if|elif|then|fi|echo)\b|\$/g,10]],["html",[/<\/?[a-z-][^\n>]*>/g,10],[/^\s+<!DOCTYPE\s+html/g,500]],["http",[/^(GET|HEAD|POST|PUT|DELETE|PATCH|HTTP)\b/g,500]],["js",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require)\b/g,10]],["ts",[/\b(console|await|async|function|export|import|this|class|for|let|const|map|join|require|implements|interface|namespace)\b/g,10]],["py",[/\b(def|print|class|and|or|lambda)\b/g,10]],["sql",[/\b(SELECT|INSERT|FROM)\b/g,50]],["pl",[/#!(\/usr)?\/bin\/perl/g,500],[/\b(use|print)\b|\$/g,10]],["lua",[/#!(\/usr)?\/bin\/lua/g,500]],["make",[/\b(ifneq|endif|if|elif|then|fi|echo|.PHONY|^[a-z]+ ?:$)\b|\$/gm,10]],["uri",[/https?:|mailto:|tel:|ftp:/g,30]],["css",[/^(@import|@page|@media|(\.|#)[a-z]+)/gm,20]],["diff",[/^[+><-]/gm,10],[/^@@[-+,0-9 ]+@@/gm,25]],["md",[/^(>|\t\*|\t\d+.|#{1,6} |-\s+|\*\s+)/gm,25],[/\[.*\](.*)/g,10]],["docker",[/^(FROM|ENTRYPOINT|RUN)/gm,500]],["xml",[/<\/?[a-z-][^\n>]*>/g,10],[/^<\?xml/g,500]],["c",[/#include\b|\bprintf\s+\(/g,100]],["rs",[/^\s+(use|fn|mut|match)\b/gm,100]],["go",[/\b(func|fmt|package)\b/g,100]],["java",[/^import\s+java/gm,500]],["asm",[/^(section|global main|extern|\t(call|mov|ret))/gm,100]],["css",[/^(@import|@page|@media|(\.|#)[a-z]+)/gm,20]],["json",[/\b(true|false|null|\{\})\b|"[^"]+":/g,10]],["yaml",[/^(\s+)?[a-z][a-z0-9]*:/gim,10]],["toml",[/^\s*\[.*\]\s*$/gm,100],[/^\s*[\w-]+ *= */gm,20]],["mermaid",[/^(graph|flowchart|sequenceDiagram|classDiagram|stateDiagram|erDiagram|gantt|pie|mindmap)/gm,500],[/\b(-->|--o|--x|=>|\[\]|[{}])\b/g,10]]];function Xt(e,t){var i;return((i=(t?[...Me,...t]:Me).map(([o,...n])=>[o,n.reduce((r,[s,a])=>r+[...e.matchAll(s)].length*a,0)]).filter(([,o])=>o>20).sort((o,n)=>n[1]-o[1])[0])===null||i===void 0?void 0:i[0])||"plain"}function k(e){return/^(?:shellscript|bash|sh|shell|zsh)/i.test(e)?"shell":/^(?:powershell|ps1?)/i.test(e)?"powershell":e.split(":")[0]}const ut=["jsx","tsx","vue","csharp","python","java","c","cpp","rust","go","powershell","sql","json","html","javascript","typescript","css","markdown","xml","yaml","toml","dockerfile","kotlin","objective-c","objective-cpp","php","ruby","scala","svelte","swift","erlang","angular-html","angular-ts","dart","lua","mermaid","cmake","nginx"],gt=["vitesse-dark","vitesse-light"],Ve={verticalScrollbarSize:8,horizontalScrollbarSize:8,handleMouseWheel:!0,alwaysConsumeMouseWheel:!1},F=16,Ee=75,We=200,he=2e5,ce=.5;function fe(e,t){if(e===t)return null;let i=0;const l=Math.min(e.length,t.length);for(;i<l&&e.charCodeAt(i)===t.charCodeAt(i);)i++;let o=e.length-1,n=t.length-1;for(;o>=i&&n>=i&&e.charCodeAt(o)===t.charCodeAt(n);)o--,n--;return{start:i,endPrevIncl:o,endNextIncl:n,replaceText:t.slice(i,n+1)}}var h={};ht(h,{default:()=>pt});ft(h,Ie);const pt=Ie;let we=0;const Ae=typeof window<"u"&&window.__STREAM_MONACO_DEBUG__!==void 0?!!window.__STREAM_MONACO_DEBUG__:!1;function L(e,...t){if(!Ae)return;we+=1;const i=`#${we}`,l=typeof performance<"u"&&performance.now?performance.now().toFixed(1):Date.now();console.warn(`${i} [${e}] @${l}ms`,...t)}function Le(e,...t){Ae&&console.error(`[${e}]`,...t)}function Be(e,t){let i=null,l=-1,o=!1;const n=12;function r(){const p=t();if(p!=null){if(L("heightManager","computeNext ->",{next:p,lastApplied:l}),!Number.isFinite(p)||p<=0){L("heightManager","invalid next height, ignoring",p);return}l!==-1&&Math.abs(p-l)<=n||p!==l&&(o=!0,e.style.height=`${p}px`,l=p,L("heightManager","applied height ->",p),queueMicrotask(()=>{o=!1}))}}function s(){{if(i!=null)return;i=requestAnimationFrame(()=>{i=null,r()});return}}function a(){s()}function f(){i!=null&&(cancelAnimationFrame(i),i=null)}function u(){return o}function M(){return l}return{update:a,dispose:f,isSuppressed:u,getLastApplied:M}}function ue(e){const t={},i={requestAnimationFrame:n=>requestAnimationFrame(n),cancelAnimationFrame:n=>cancelAnimationFrame(n)};function l(n,r){const s=t[n];s!=null&&i.cancelAnimationFrame(s),t[n]=i.requestAnimationFrame(a=>{t[n]=null,r(a)})}function o(n){const r=t[n];r!=null&&(i.cancelAnimationFrame(r),t[n]=null)}return{schedule:l,cancel:o}}function xe(e,t){var i,l;const o=((i=e.getScrollTop)===null||i===void 0?void 0:i.call(e))??0;t.setLast(o),L("scrollWatcher","initial scrollTop=",o);let n=!1;const r=6;let s=null,a=null;const f=p=>{var S;if(n){L("scrollWatcher","suppressedExternally, ignoring event");return}const w=p&&typeof p.scrollTop=="number"?p.scrollTop:((S=e.getScrollTop)===null||S===void 0?void 0:S.call(e))??0,y=w-t.getLast();if(t.setLast(w),Math.abs(y)<r){L("scrollWatcher","small delta ignored",y);try{const D=typeof e.getScrollHeight=="function"?e.getScrollHeight():void 0,T=typeof e.getLayoutInfo=="function"?e.getLayoutInfo():void 0,V=(T==null?void 0:T.height)??void 0;if(typeof D=="number"&&typeof V=="number"){const W=D-(w+V);W<=Math.max(r,0)&&(L("scrollWatcher","small delta but at bottom, maybe resume",{distance:W}),t.onMaybeResume())}}catch{}return}if(L("scrollWatcher","delta=",y,"currentTop=",w),y<0){L("scrollWatcher","pause detected delta=",y),t.onPause();return}L("scrollWatcher","maybe resume delta=",y),t.onMaybeResume()},u=((l=e.onDidScrollChange)===null||l===void 0?void 0:l.call(e,f))??null;return{dispose(){try{u&&typeof u.dispose=="function"?u.dispose():typeof u=="function"&&u()}catch{}L("scrollWatcher","dispose")},setSuppressed(p){const S=!!p;if(S!==n){n=S,L("scrollWatcher","setSuppressed =>",n);try{!s&&typeof e.getDomNode=="function"&&(s=e.getDomNode()),n&&s?a||(a=()=>{try{var w;L("scrollWatcher","user interaction detected while suppressed, cancelling suppression"),t.onPause(),n=!1;const y=((w=e.getScrollTop)===null||w===void 0?void 0:w.call(e))??0;t.setLast(y);try{const D=typeof e.getScrollHeight=="function"?e.getScrollHeight():void 0,T=typeof e.getLayoutInfo=="function"?e.getLayoutInfo():void 0,V=(T==null?void 0:T.height)??void 0;if(typeof D=="number"&&typeof V=="number"){const W=D-(y+V);W<=Math.max(r,0)&&(L("scrollWatcher","interaction moved to bottom, maybe resume",{distance:W}),t.onMaybeResume())}}catch{}s&&a&&(s.removeEventListener("wheel",a,{passive:!0}),s.removeEventListener("pointerdown",a),s.removeEventListener("touchstart",a)),a=null}catch{}},s.addEventListener("wheel",a,{passive:!0}),s.addEventListener("pointerdown",a),s.addEventListener("touchstart",a)):s&&a&&(s.removeEventListener("wheel",a,{passive:!0}),s.removeEventListener("pointerdown",a),s.removeEventListener("touchstart",a),a=null)}catch{}}}}}var mt=class{constructor(e,t,i,l,o,n,r,s,a){g(this,"diffEditorView",null);g(this,"originalModel",null);g(this,"modifiedModel",null);g(this,"lastContainer",null);g(this,"lastKnownOriginalCode",null);g(this,"lastKnownModifiedCode",null);g(this,"lastKnownModifiedLineCount",null);g(this,"pendingDiffUpdate",null);g(this,"shouldAutoScrollDiff",!0);g(this,"diffScrollWatcher",null);g(this,"lastScrollTopDiff",0);g(this,"_hasScrollBar",!1);g(this,"cachedScrollHeightDiff",null);g(this,"cachedLineHeightDiff",null);g(this,"cachedComputedHeightDiff",null);g(this,"lastKnownModifiedDirty",!1);g(this,"lastRevealLineDiff",null);g(this,"revealTicketDiff",0);g(this,"revealDebounceIdDiff",null);g(this,"revealDebounceMs",Ee);g(this,"revealIdleTimerIdDiff",null);g(this,"revealStrategyOption");g(this,"revealBatchOnIdleMsOption");g(this,"scrollWatcherSuppressionMs",500);g(this,"diffScrollWatcherSuppressionTimer",null);g(this,"appendBufferDiff",[]);g(this,"appendBufferDiffScheduled",!1);g(this,"rafScheduler",ue());g(this,"diffHeightManager",null);this.options=e,this.maxHeightValue=t,this.maxHeightCSS=i,this.autoScrollOnUpdate=l,this.autoScrollInitial=o,this.autoScrollThresholdPx=n,this.autoScrollThresholdLines=r,this.diffAutoScroll=s,this.revealDebounceMsOption=a}measureViewportDiff(){var e,t,i;if(!this.diffEditorView)return null;const l=this.diffEditorView.getModifiedEditor(),o=((e=l.getLayoutInfo)===null||e===void 0?void 0:e.call(l))??null,n=this.cachedLineHeightDiff??l.getOption(h.editor.EditorOption.lineHeight),r=((t=l.getScrollTop)===null||t===void 0?void 0:t.call(l))??this.lastScrollTopDiff??0,s=((i=l.getScrollHeight)===null||i===void 0?void 0:i.call(l))??this.cachedScrollHeightDiff??(o==null?void 0:o.height)??0,a=this.cachedComputedHeightDiff??this.computedHeight();return this.cachedLineHeightDiff=n,this.cachedScrollHeightDiff=s,this.cachedComputedHeightDiff=a,this.lastScrollTopDiff=r,{me:l,li:o,lineHeight:n,scrollTop:r,scrollHeight:s,computedHeight:a}}computedHeight(){var e,t,i,l;if(!this.diffEditorView)return Math.min(18+F,this.maxHeightValue);const o=this.diffEditorView.getModifiedEditor(),n=this.diffEditorView.getOriginalEditor(),r=o.getOption(h.editor.EditorOption.lineHeight),s=((e=n.getModel())===null||e===void 0?void 0:e.getLineCount())??1,a=((t=o.getModel())===null||t===void 0?void 0:t.getLineCount())??1,u=Math.max(s,a)*r+F,M=Math.max(((i=n.getScrollHeight)===null||i===void 0?void 0:i.call(n))??0,((l=o.getScrollHeight)===null||l===void 0?void 0:l.call(o))??0),p=Math.max(u,M);return Math.min(p,this.maxHeightValue)}isOverflowAutoDiff(){return!!this.lastContainer&&this.lastContainer.style.overflow==="auto"}shouldPerformImmediateRevealDiff(){return this.autoScrollOnUpdate&&this.shouldAutoScrollDiff&&this.hasVerticalScrollbarModified()&&this.isOverflowAutoDiff()}suppressScrollWatcherDiff(e){!this.diffScrollWatcher||typeof this.diffScrollWatcher.setSuppressed!="function"||(this.diffScrollWatcherSuppressionTimer!=null&&(clearTimeout(this.diffScrollWatcherSuppressionTimer),this.diffScrollWatcherSuppressionTimer=null),this.diffScrollWatcher.setSuppressed(!0),this.diffScrollWatcherSuppressionTimer=setTimeout(()=>{try{this.diffScrollWatcher.setSuppressed(!1)}catch{}this.diffScrollWatcherSuppressionTimer=null},e))}hasVerticalScrollbarModified(){if(!this.diffEditorView)return!1;if(this._hasScrollBar)return!0;const e=this.measureViewportDiff();if(!e)return!1;const t=Math.max(2,Math.round(e.lineHeight/8));return this._hasScrollBar=e.scrollHeight>e.computedHeight+Math.max(F/2,t)}userIsNearBottomDiff(){if(!this.diffEditorView)return!0;const e=this.measureViewportDiff();if(!e||!e.li)return!0;const t=(this.autoScrollThresholdLines??0)*e.lineHeight,i=Math.max(t||0,this.autoScrollThresholdPx||0);return e.scrollHeight-(e.scrollTop+e.li.height)<=i}maybeScrollDiffToBottom(e,t){this.rafScheduler.schedule("maybe-scroll-diff",()=>{if(L("diff","maybeScrollDiffToBottom called",{targetLine:e,prevLineOverride:t,diffAutoScroll:this.diffAutoScroll,autoScrollOnUpdate:this.autoScrollOnUpdate,shouldAutoScrollDiff:this.shouldAutoScrollDiff}),!this.diffEditorView)return;const i=this.hasVerticalScrollbarModified();if(L("diff","hasVerticalScrollbarModified ->",i),!(this.diffAutoScroll&&this.autoScrollOnUpdate&&this.shouldAutoScrollDiff&&i))return;const o=this.diffEditorView.getModifiedEditor().getModel(),n=(o==null?void 0:o.getLineCount())??1,r=e??n,s=typeof t=="number"?t:this.lastKnownModifiedLineCount??-1;if(L("diff","scroll metrics",{prevLine:s,currentLine:n,line:r,lastRevealLineDiff:this.lastRevealLineDiff}),s!==-1&&s===n&&r===n||this.lastRevealLineDiff!==null&&this.lastRevealLineDiff===r)return;const a=this.revealBatchOnIdleMsOption??this.options.revealBatchOnIdleMs??We;if(L("diff","reveal timing",{batchMs:a,revealDebounceMs:this.revealDebounceMs,revealDebounceMsOption:this.revealDebounceMsOption}),typeof a=="number"&&a>0){if(i){const M=++this.revealTicketDiff;L("diff","has scrollbar -> immediate ticketed reveal",{ticket:M,line:r}),this.performRevealDiffTicketed(r,M);return}this.revealIdleTimerIdDiff!=null&&clearTimeout(this.revealIdleTimerIdDiff);const u=++this.revealTicketDiff;L("diff","scheduling idle reveal",{ticket:u,batchMs:a,line:r}),this.revealIdleTimerIdDiff=setTimeout(()=>{this.revealIdleTimerIdDiff=null,this.performRevealDiffTicketed(r,u)},a);return}this.revealDebounceIdDiff!=null&&(clearTimeout(this.revealDebounceIdDiff),this.revealDebounceIdDiff=null);const f=typeof this.revealDebounceMs=="number"&&this.revealDebounceMs>0?this.revealDebounceMs:typeof this.revealDebounceMsOption=="number"&&this.revealDebounceMsOption>0?this.revealDebounceMsOption:this.revealDebounceMs;this.revealDebounceIdDiff=setTimeout(()=>{this.revealDebounceIdDiff=null;const u=++this.revealTicketDiff;L("diff","debounced reveal firing",{ticket:u,line:r}),this.performRevealDiffTicketed(r,u)},f),this.lastKnownModifiedLineCount=n})}performRevealDiffTicketed(e,t){this.rafScheduler.schedule("revealDiff",()=>{var i;if(this.diffScrollWatcher&&(L("diff","performRevealDiffTicketed - suppressing watcher",{ticket:t,line:e,ms:this.scrollWatcherSuppressionMs}),this.suppressScrollWatcherDiff(this.scrollWatcherSuppressionMs)),t!==this.revealTicketDiff)return;L("diff","performRevealDiffTicketed - performing reveal",{ticket:t,line:e});const l=this.revealStrategyOption??this.options.revealStrategy??"centerIfOutside",o=h.ScrollType||((i=h.editor)===null||i===void 0?void 0:i.ScrollType),n=o&&typeof o.Smooth<"u"?o.Smooth:void 0;try{const f=this.diffEditorView.getModifiedEditor();l==="bottom"?typeof n<"u"?f.revealLine(e,n):f.revealLine(e):l==="center"?typeof n<"u"?f.revealLineInCenter(e,n):f.revealLineInCenter(e):typeof n<"u"?f.revealLineInCenterIfOutsideViewport(e,n):f.revealLineInCenterIfOutsideViewport(e)}catch{try{this.diffEditorView.getModifiedEditor().revealLine(e)}catch{}}this.lastRevealLineDiff=e,L("diff","performRevealDiffTicketed - revealed",{line:e,lastRevealLineDiff:this.lastRevealLineDiff});try{var r,s,a;this.shouldAutoScrollDiff=!0,this.lastScrollTopDiff=((r=this.diffEditorView)===null||r===void 0||(a=(s=r.getModifiedEditor()).getScrollTop)===null||a===void 0?void 0:a.call(s))??this.lastScrollTopDiff}catch{}})}performImmediateRevealDiff(e,t){var i;if(!this.diffEditorView||t!==this.revealTicketDiff)return;const l=h.ScrollType||((i=h.editor)===null||i===void 0?void 0:i.ScrollType),o=l&&typeof l.Immediate<"u"?l.Immediate:void 0,n=this.diffEditorView.getModifiedEditor();typeof o<"u"?n.revealLine(e,o):n.revealLine(e),this.measureViewportDiff(),L("diff","performImmediateRevealDiff",{line:e,ticket:t});try{var r,s,a;this.shouldAutoScrollDiff=!0,this.lastScrollTopDiff=((r=this.diffEditorView)===null||r===void 0||(a=(s=r.getModifiedEditor()).getScrollTop)===null||a===void 0?void 0:a.call(s))??this.lastScrollTopDiff}catch{}}scheduleImmediateRevealAfterLayoutDiff(e){const t=++this.revealTicketDiff;this.rafScheduler.schedule("immediate-reveal-diff",async()=>{const i=this.diffEditorView&&this.diffHeightManager?Math.min(this.computedHeight(),this.maxHeightValue):-1;i!==-1&&this.diffHeightManager&&(this.lastContainer&&(this.lastContainer.style.height=`${i}px`),await this.waitForHeightAppliedDiff(i)),this.performImmediateRevealDiff(e,t)})}waitForHeightAppliedDiff(e,t=500){return new Promise(i=>{const l=typeof performance<"u"&&performance.now?performance.now():Date.now(),o=()=>{if((this.lastContainer?Number.parseFloat((this.lastContainer.style.height||"").replace("px",""))||0:-1)>=e-1){i();return}if((typeof performance<"u"&&performance.now?performance.now():Date.now())-l>t){i();return}requestAnimationFrame(o)};o()})}async createDiffEditor(e,t,i,l,o){var n,r,s,a;this.cleanup(),this.lastContainer=e,e.style.overflow="hidden",e.style.maxHeight=this.maxHeightCSS;const f=k(l)||l;if(this.originalModel=h.editor.createModel(t,f),this.modifiedModel=h.editor.createModel(i,f),this.diffEditorView=h.editor.createDiffEditor(e,{automaticLayout:!0,scrollBeyondLastLine:!1,renderSideBySide:!0,originalEditable:!1,readOnly:this.options.readOnly??!0,minimap:{enabled:!1},theme:o,contextmenu:!1,scrollbar:{...Ve,...this.options.scrollbar||{}},...this.options}),h.editor.setTheme(o),this.diffEditorView.setModel({original:this.originalModel,modified:this.modifiedModel}),this.lastKnownOriginalCode=t,this.lastKnownModifiedCode=i,this.shouldAutoScrollDiff=!!(this.autoScrollInitial&&this.diffAutoScroll),this.diffScrollWatcher&&(this.diffScrollWatcher.dispose(),this.diffScrollWatcher=null),this.diffAutoScroll){const y=this.diffEditorView.getModifiedEditor();this.diffScrollWatcher=xe(y,{onPause:()=>{this.shouldAutoScrollDiff=!1},onMaybeResume:()=>{this.rafScheduler.schedule("maybe-resume-diff",()=>{this.shouldAutoScrollDiff=this.userIsNearBottomDiff()})},getLast:()=>this.lastScrollTopDiff,setLast:D=>{this.lastScrollTopDiff=D}})}L("diff","createDiffEditor",{autoScrollInitial:this.autoScrollInitial,diffAutoScroll:this.diffAutoScroll});const u=Math.min(120,this.maxHeightValue);e.style.minHeight=`${u}px`,this.diffHeightManager&&(this.diffHeightManager.dispose(),this.diffHeightManager=null),this.diffHeightManager=Be(e,()=>this.computedHeight()),this.diffHeightManager.update(),this.computedHeight()>=this.maxHeightValue-1&&(e.style.height=`${this.maxHeightValue}px`,e.style.overflow="auto");const p=this.diffEditorView.getModifiedEditor();this.cachedScrollHeightDiff=((n=p.getScrollHeight)===null||n===void 0?void 0:n.call(p))??null,this.cachedLineHeightDiff=((r=p.getOption)===null||r===void 0?void 0:r.call(p,h.editor.EditorOption.lineHeight))??null,this.cachedComputedHeightDiff=this.computedHeight();const S=this.diffEditorView.getOriginalEditor(),w=this.diffEditorView.getModifiedEditor();return(s=S.onDidContentSizeChange)===null||s===void 0||s.call(S,()=>{this._hasScrollBar=!1,this.rafScheduler.schedule("content-size-change-diff",()=>{var y,D,T,V;if(this.cachedScrollHeightDiff=((y=S.getScrollHeight)===null||y===void 0?void 0:y.call(S))??this.cachedScrollHeightDiff,this.cachedLineHeightDiff=((D=S.getOption)===null||D===void 0?void 0:D.call(S,h.editor.EditorOption.lineHeight))??this.cachedLineHeightDiff,this.cachedComputedHeightDiff=this.computedHeight(),!((T=this.diffHeightManager)===null||T===void 0)&&T.isSuppressed())return;(V=this.diffHeightManager)===null||V===void 0||V.update();const W=this.computedHeight();if(this.lastContainer){const K=this.lastContainer.style.overflow,I=W>=this.maxHeightValue-1?"auto":"hidden";if(K!==I&&(this.lastContainer.style.overflow=I,I==="auto"&&this.shouldAutoScrollDiff)){var B;this.maybeScrollDiffToBottom((B=this.modifiedModel)===null||B===void 0?void 0:B.getLineCount())}}})}),(a=w.onDidContentSizeChange)===null||a===void 0||a.call(w,()=>{this._hasScrollBar=!1,this.rafScheduler.schedule("content-size-change-diff",()=>{var y,D,T,V;if(this.cachedScrollHeightDiff=((y=w.getScrollHeight)===null||y===void 0?void 0:y.call(w))??this.cachedScrollHeightDiff,this.cachedLineHeightDiff=((D=w.getOption)===null||D===void 0?void 0:D.call(w,h.editor.EditorOption.lineHeight))??this.cachedLineHeightDiff,this.cachedComputedHeightDiff=this.computedHeight(),!((T=this.diffHeightManager)===null||T===void 0)&&T.isSuppressed())return;(V=this.diffHeightManager)===null||V===void 0||V.update();const W=this.computedHeight();if(this.lastContainer){const K=this.lastContainer.style.overflow,I=W>=this.maxHeightValue-1?"auto":"hidden";if(K!==I&&(this.lastContainer.style.overflow=I,I==="auto"&&this.shouldAutoScrollDiff)){var B;this.maybeScrollDiffToBottom((B=this.modifiedModel)===null||B===void 0?void 0:B.getLineCount())}}})}),w.onDidChangeModelContent(()=>{this.lastKnownModifiedDirty=!0,this.rafScheduler.schedule("sync-last-known-modified",()=>this.syncLastKnownModified())}),this.maybeScrollDiffToBottom(this.modifiedModel.getLineCount(),this.lastKnownModifiedLineCount??void 0),this.diffEditorView}updateDiff(e,t,i){if(!this.diffEditorView||!this.originalModel||!this.modifiedModel)return;const l=i?k(i):void 0;if(l&&(this.originalModel.getLanguageId()!==l||this.modifiedModel.getLanguageId()!==l)){this.pendingDiffUpdate={original:e,modified:t,lang:i},this.rafScheduler.schedule("diff",()=>this.flushPendingDiffUpdate());return}this.lastKnownOriginalCode==null&&(this.lastKnownOriginalCode=this.originalModel.getValue()),this.lastKnownModifiedCode==null&&(this.lastKnownModifiedCode=this.modifiedModel.getValue());const o=this.lastKnownOriginalCode,n=this.lastKnownModifiedCode;if(e!==o&&e.startsWith(o)&&(this.appendToModel(this.originalModel,e.slice(o.length)),this.lastKnownOriginalCode=e),t!==n&&t.startsWith(n)){const r=this.modifiedModel.getLineCount();this.appendToModel(this.modifiedModel,t.slice(n.length)),this.lastKnownModifiedCode=t,this.maybeScrollDiffToBottom(this.modifiedModel.getLineCount(),r)}(e!==this.lastKnownOriginalCode||t!==this.lastKnownModifiedCode)&&(this.pendingDiffUpdate={original:e,modified:t},this.rafScheduler.schedule("diff",()=>this.flushPendingDiffUpdate()))}updateOriginal(e,t){if(!this.diffEditorView||!this.originalModel)return;if(t){const l=k(t);l&&this.originalModel.getLanguageId()!==l&&h.editor.setModelLanguage(this.originalModel,l)}const i=this.lastKnownOriginalCode??this.originalModel.getValue();i!==e&&(e.startsWith(i)&&i.length<e.length?this.appendToModel(this.originalModel,e.slice(i.length)):this.applyMinimalEditToModel(this.originalModel,i,e),this.lastKnownOriginalCode=e)}updateModified(e,t){if(!this.diffEditorView||!this.modifiedModel)return;if(t){const s=k(t);s&&this.modifiedModel.getLanguageId()!==s&&h.editor.setModelLanguage(this.modifiedModel,s)}const i=this.lastKnownModifiedCode??this.modifiedModel.getValue();if(i===e)return;const l=this.modifiedModel.getLineCount();if(e.startsWith(i)&&i.length<e.length)this.appendToModel(this.modifiedModel,e.slice(i.length)),this.maybeScrollDiffToBottom(this.modifiedModel.getLineCount(),l);else{this.applyMinimalEditToModel(this.modifiedModel,i,e);const s=this.modifiedModel.getLineCount();if(s!==l){const a=this.shouldPerformImmediateRevealDiff();if(a&&this.suppressScrollWatcherDiff(this.scrollWatcherSuppressionMs+800),this.computedHeight()>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`,this.lastContainer.style.overflow="auto"),a?this.scheduleImmediateRevealAfterLayoutDiff(s):this.maybeScrollDiffToBottom(s,l),this.autoScrollOnUpdate&&this.shouldAutoScrollDiff)try{var o,n,r;const u=h.ScrollType||((o=h.editor)===null||o===void 0?void 0:o.ScrollType),M=u&&typeof u.Immediate<"u"?u.Immediate:void 0,p=this.diffEditorView.getModifiedEditor(),S=((n=p.getModel())===null||n===void 0?void 0:n.getLineCount())??s;typeof M<"u"?p.revealLine(S,M):p.revealLine(S),this.lastRevealLineDiff=S,this.shouldAutoScrollDiff=!0,this.lastScrollTopDiff=((r=p.getScrollTop)===null||r===void 0?void 0:r.call(p))??this.lastScrollTopDiff}catch{}}}this.lastKnownModifiedCode=e}appendOriginal(e,t){if(!(!this.diffEditorView||!this.originalModel||!e)){if(t){const i=k(t);i&&this.originalModel.getLanguageId()!==i&&h.editor.setModelLanguage(this.originalModel,i)}this.appendToModel(this.originalModel,e),this.lastKnownOriginalCode=this.originalModel.getValue()}}appendModified(e,t){if(!(!this.diffEditorView||!this.modifiedModel||!e)){if(t){const i=k(t);i&&this.modifiedModel.getLanguageId()!==i&&h.editor.setModelLanguage(this.modifiedModel,i)}this.appendBufferDiff.push(e),this.appendBufferDiffScheduled||(this.appendBufferDiffScheduled=!0,this.rafScheduler.schedule("appendDiff",()=>this.flushAppendBufferDiff()))}}setLanguage(e,t){if(!t.includes(e)){console.warn(`Language "${e}" is not registered. Available languages: ${t.join(", ")}`);return}this.originalModel&&this.originalModel.getLanguageId()!==e&&h.editor.setModelLanguage(this.originalModel,e),this.modifiedModel&&this.modifiedModel.getLanguageId()!==e&&h.editor.setModelLanguage(this.modifiedModel,e)}getDiffEditorView(){return this.diffEditorView}getDiffModels(){return{original:this.originalModel,modified:this.modifiedModel}}cleanup(){this.rafScheduler.cancel("diff"),this.pendingDiffUpdate=null,this.rafScheduler.cancel("appendDiff"),this.appendBufferDiffScheduled=!1,this.appendBufferDiff.length=0,this.rafScheduler.cancel("content-size-change-diff"),this.rafScheduler.cancel("sync-last-known-modified"),this.diffScrollWatcher&&(this.diffScrollWatcher.dispose(),this.diffScrollWatcher=null),this.diffHeightManager&&(this.diffHeightManager.dispose(),this.diffHeightManager=null),this.diffEditorView&&(this.diffEditorView.dispose(),this.diffEditorView=null),this.originalModel&&(this.originalModel.dispose(),this.originalModel=null),this.modifiedModel&&(this.modifiedModel.dispose(),this.modifiedModel=null),this.lastKnownOriginalCode=null,this.lastKnownModifiedCode=null,this.lastContainer&&(this.lastContainer.innerHTML="",this.lastContainer=null),this.revealDebounceIdDiff!=null&&(clearTimeout(this.revealDebounceIdDiff),this.revealDebounceIdDiff=null),this.revealIdleTimerIdDiff!=null&&(clearTimeout(this.revealIdleTimerIdDiff),this.revealIdleTimerIdDiff=null),this.diffScrollWatcherSuppressionTimer!=null&&(clearTimeout(this.diffScrollWatcherSuppressionTimer),this.diffScrollWatcherSuppressionTimer=null),this.revealTicketDiff=0,this.lastRevealLineDiff=null}safeClean(){this.rafScheduler.cancel("diff"),this.pendingDiffUpdate=null,this.diffScrollWatcher&&(this.diffScrollWatcher.dispose(),this.diffScrollWatcher=null),this._hasScrollBar=!1,this.shouldAutoScrollDiff=!!(this.autoScrollInitial&&this.diffAutoScroll),this.lastScrollTopDiff=0,this.diffHeightManager&&(this.diffHeightManager.dispose(),this.diffHeightManager=null),this.revealDebounceIdDiff!=null&&(clearTimeout(this.revealDebounceIdDiff),this.revealDebounceIdDiff=null),this.revealIdleTimerIdDiff!=null&&(clearTimeout(this.revealIdleTimerIdDiff),this.revealIdleTimerIdDiff=null),this.diffScrollWatcherSuppressionTimer!=null&&(clearTimeout(this.diffScrollWatcherSuppressionTimer),this.diffScrollWatcherSuppressionTimer=null),this.revealTicketDiff=0,this.lastRevealLineDiff=null,this.rafScheduler.cancel("content-size-change-diff"),this.rafScheduler.cancel("sync-last-known-modified")}syncLastKnownModified(){if(!(!this.diffEditorView||!this.lastKnownModifiedDirty))try{const t=this.diffEditorView.getModifiedEditor().getModel();t&&(this.lastKnownModifiedCode=t.getValue(),this.lastKnownModifiedLineCount=t.getLineCount())}finally{this.lastKnownModifiedDirty=!1}}flushPendingDiffUpdate(){if(!this.pendingDiffUpdate||!this.diffEditorView)return;const e=this.originalModel,t=this.modifiedModel;if(!e||!t){this.pendingDiffUpdate=null;return}const{original:i,modified:l,lang:o}=this.pendingDiffUpdate;if(this.pendingDiffUpdate=null,o){const f=k(o);f&&e.getLanguageId()!==f&&(h.editor.setModelLanguage(e,f),h.editor.setModelLanguage(t,f))}this.lastKnownOriginalCode==null&&(this.lastKnownOriginalCode=e.getValue()),this.lastKnownModifiedCode==null&&(this.lastKnownModifiedCode=t.getValue());const n=this.lastKnownOriginalCode;n!==i&&(i.startsWith(n)&&n.length<i.length?this.appendToModel(e,i.slice(n.length)):this.applyMinimalEditToModel(e,n,i),this.lastKnownOriginalCode=i);let r=this.lastKnownModifiedCode;const s=this.appendBufferDiff.length>0?this.appendBufferDiff.join(""):"";if(this.appendBufferDiff.length>0)try{r=t.getValue()+s,this.lastKnownModifiedCode=r}catch{r=(this.lastKnownModifiedCode??"")+s}const a=t.getLineCount();if(r!==l){l.startsWith(r)&&r.length<l.length?this.appendToModel(t,l.slice(r.length)):this.applyMinimalEditToModel(t,r,l),this.lastKnownModifiedCode=l;const f=t.getLineCount();if(f!==a){const u=this.shouldPerformImmediateRevealDiff();u&&this.suppressScrollWatcherDiff(this.scrollWatcherSuppressionMs+800),this.computedHeight()>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`,this.lastContainer.style.overflow="auto"),u?this.scheduleImmediateRevealAfterLayoutDiff(f):this.maybeScrollDiffToBottom(f,a)}}}async flushAppendBufferDiff(){if(!this.diffEditorView||this.appendBufferDiff.length===0)return;this.appendBufferDiffScheduled=!1;const t=this.diffEditorView.getModifiedEditor().getModel();if(!t){this.appendBufferDiff.length=0;return}let i=this.appendBufferDiff.splice(0);const l=t.getLineCount(),o=i.join(""),n=o.length;if(i.length===1&&n>5e3){const I=o.split(/\r?\n/),b=200,A=[];for(let x=0;x<I.length;x+=b)A.push(`${I.slice(x,x+b).join(`
`)}
`);A.length>1&&(i=A)}const r=i.length>1&&(n>2e3||t.getLineCount&&t.getLineCount()+0-l>50);L("diff","flushAppendBufferDiff start",{partsCount:i.length,totalChars:n,applyChunked:r});let s=l;const a=this.diffScrollWatcher;let f=!1;if(a&&typeof a.setSuppressed=="function")try{this.diffScrollWatcherSuppressionTimer!=null&&(clearTimeout(this.diffScrollWatcherSuppressionTimer),this.diffScrollWatcherSuppressionTimer=null),a.setSuppressed(!0),f=!0}catch{}if(r){L("diff","flushAppendBufferDiff applying chunked",{partsLen:i.length});let I=0;for(const b of i){if(!b)continue;I+=1,L("diff","flushAppendBufferDiff chunk",{idx:I,partLen:b.length,prevLine:s});const A=t.getLineMaxColumn(s),x=new h.Range(s,A,s,A);t.applyEdits([{range:x,text:b,forceMoveMarkers:!0}]),this.lastKnownModifiedCode=t.getValue();const O=t.getLineCount();this.lastKnownModifiedLineCount=O,await new Promise(P=>typeof requestAnimationFrame<"u"?requestAnimationFrame(P):setTimeout(P,0));const _=this.shouldPerformImmediateRevealDiff();L("diff","flushAppendBufferDiff chunk metrics",{idx:I,newLine:O,prevLine:s,shouldImmediate:_}),_&&this.suppressScrollWatcherDiff(this.scrollWatcherSuppressionMs+800),this.computedHeight()>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`,this.lastContainer.style.overflow="auto"),_?this.scheduleImmediateRevealAfterLayoutDiff(O):this.maybeScrollDiffToBottom(O,s),s=O,L("diff","flushAppendBufferDiff chunk applied",{idx:I,newLine:O})}f&&a.setSuppressed(!1);return}const u=o;this.appendBufferDiff.length=0,s=t.getLineCount();const M=t.getLineMaxColumn(s),p=new h.Range(s,M,s,M);t.applyEdits([{range:p,text:u,forceMoveMarkers:!0}]),this.lastKnownModifiedCode=t.getValue();const S=t.getLineCount();this.lastKnownModifiedLineCount=S;const w=this.shouldPerformImmediateRevealDiff();if(w&&this.suppressScrollWatcherDiff(this.scrollWatcherSuppressionMs+800),this.computedHeight()>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`),w?this.scheduleImmediateRevealAfterLayoutDiff(S):this.maybeScrollDiffToBottom(S,s),this.autoScrollOnUpdate&&this.shouldAutoScrollDiff)try{var D,T,V;const I=h.ScrollType||((D=h.editor)===null||D===void 0?void 0:D.ScrollType),b=I&&typeof I.Immediate<"u"?I.Immediate:void 0,A=this.diffEditorView.getModifiedEditor(),x=((T=A.getModel())===null||T===void 0?void 0:T.getLineCount())??S;typeof b<"u"?A.revealLine(x,b):A.revealLine(x),this.lastRevealLineDiff=x,this.shouldAutoScrollDiff=!0,this.lastScrollTopDiff=((V=A.getScrollTop)===null||V===void 0?void 0:V.call(A))??this.lastScrollTopDiff}catch{}f&&a.setSuppressed(!1);try{var W,B,K;this.shouldAutoScrollDiff=!0,this.lastScrollTopDiff=((W=this.diffEditorView)===null||W===void 0||(K=(B=W.getModifiedEditor()).getScrollTop)===null||K===void 0?void 0:K.call(B))??this.lastScrollTopDiff}catch{}}applyMinimalEditToModel(e,t,i){const l=he,o=ce,n=Math.max(t.length,i.length),r=n>0?Math.abs(i.length-t.length)/n:0;if(t.length+i.length>l||r>o){e.setValue(i),e===this.modifiedModel&&(this.lastKnownModifiedLineCount=e.getLineCount());return}const s=fe(t,i);if(!s)return;const{start:a,endPrevIncl:f,replaceText:u}=s,M=e.getPositionAt(a),p=e.getPositionAt(f+1),S=new h.Range(M.lineNumber,M.column,p.lineNumber,p.column);e.applyEdits([{range:S,text:u,forceMoveMarkers:!0}]),e===this.modifiedModel&&(this.lastKnownModifiedLineCount=e.getLineCount())}appendToModel(e,t){if(!t)return;const i=e.getLineCount(),l=e.getLineMaxColumn(i),o=new h.Range(i,l,i,l);e.applyEdits([{range:o,text:t,forceMoveMarkers:!0}]),e===this.modifiedModel&&(this.lastKnownModifiedLineCount=e.getLineCount())}},vt=class{constructor(e,t,i,l,o,n,r,s){g(this,"editorView",null);g(this,"lastContainer",null);g(this,"lastKnownCode",null);g(this,"pendingUpdate",null);g(this,"_hasScrollBar",!1);g(this,"shouldAutoScroll",!0);g(this,"scrollWatcher",null);g(this,"scrollWatcherSuppressionTimer",null);g(this,"lastScrollTop",0);g(this,"cachedScrollHeight",null);g(this,"cachedLineHeight",null);g(this,"cachedComputedHeight",null);g(this,"cachedLineCount",null);g(this,"lastKnownCodeDirty",!1);g(this,"debug",!1);g(this,"appendBuffer",[]);g(this,"appendBufferScheduled",!1);g(this,"rafScheduler",ue());g(this,"editorHeightManager",null);g(this,"revealDebounceId",null);g(this,"revealDebounceMs",Ee);g(this,"revealIdleTimerId",null);g(this,"revealTicket",0);g(this,"revealStrategyOption");g(this,"revealBatchOnIdleMsOption");g(this,"scrollWatcherSuppressionMs",500);this.options=e,this.maxHeightValue=t,this.maxHeightCSS=i,this.autoScrollOnUpdate=l,this.autoScrollInitial=o,this.autoScrollThresholdPx=n,this.autoScrollThresholdLines=r,this.revealDebounceMsOption=s}measureViewport(){var e,t,i,l,o,n;if(!this.editorView)return null;const r=((e=(t=this.editorView).getLayoutInfo)===null||e===void 0?void 0:e.call(t))??null,s=this.cachedLineHeight??this.editorView.getOption(h.editor.EditorOption.lineHeight),a=((i=(l=this.editorView).getScrollTop)===null||i===void 0?void 0:i.call(l))??this.lastScrollTop??0,f=((o=(n=this.editorView).getScrollHeight)===null||o===void 0?void 0:o.call(n))??this.cachedScrollHeight??(r==null?void 0:r.height)??0,u=this.cachedComputedHeight??this.computedHeight(this.editorView);return this.cachedLineHeight=s,this.cachedScrollHeight=f,this.cachedComputedHeight=u,this.lastScrollTop=a,{li:r,lineHeight:s,scrollTop:a,scrollHeight:f,computedHeight:u}}initDebugFlag(){if(typeof window<"u"&&window.__STREAM_MONACO_DEBUG__!==void 0){this.debug=!!window.__STREAM_MONACO_DEBUG__;return}if(this.options&&this.options.debug!==void 0){this.debug=!!this.options.debug;return}this.debug=!1}dlog(...e){this.debug&&L("EditorManager",...e)}hasVerticalScrollbar(){if(!this.editorView)return!1;if(this._hasScrollBar)return!0;const e=this.measureViewport();return e?this._hasScrollBar=e.scrollHeight>e.computedHeight+F/2:!1}userIsNearBottom(){if(!this.editorView)return!0;const e=this.measureViewport();if(!e||!e.li)return!0;const t=(this.autoScrollThresholdLines??0)*e.lineHeight,i=Math.max(t||0,this.autoScrollThresholdPx||0);return e.scrollHeight-(e.scrollTop+e.li.height)<=i}computedHeight(e){var t;const i=this.cachedLineCount??((t=e.getModel())===null||t===void 0?void 0:t.getLineCount())??1,l=e.getOption(h.editor.EditorOption.lineHeight),o=Math.min(i*l+F,this.maxHeightValue);return L("EditorManager.computedHeight",{lineCount:i,lineHeight:l,computed:o,maxHeightValue:this.maxHeightValue}),o}maybeScrollToBottom(e){this.rafScheduler.schedule("maybe-scroll",()=>{const t=this.hasVerticalScrollbar();if(this.dlog("maybeScrollToBottom called",{autoScrollOnUpdate:this.autoScrollOnUpdate,shouldAutoScroll:this.shouldAutoScroll,hasVerticalScrollbar:t,targetLine:e}),!(this.autoScrollOnUpdate&&this.shouldAutoScroll&&this.hasVerticalScrollbar())){this.dlog("maybeScrollToBottom skipped (auto-scroll conditions not met)");return}const i=this.editorView.getModel(),l=e??(i==null?void 0:i.getLineCount())??1,o=this.revealBatchOnIdleMsOption??this.options.revealBatchOnIdleMs??We;if(typeof o=="number"&&o>0){this.revealIdleTimerId!=null&&clearTimeout(this.revealIdleTimerId);const r=++this.revealTicket;this.dlog("scheduled idle reveal ticket=",r,"line=",l,"batchMs=",o),this.revealIdleTimerId=setTimeout(()=>{this.revealIdleTimerId=null,this.dlog("idle reveal timer firing, ticket=",r,"line=",l),this.performReveal(l,r)},o);return}this.revealDebounceId!=null&&(clearTimeout(this.revealDebounceId),this.revealDebounceId=null);const n=typeof this.revealDebounceMs=="number"&&this.revealDebounceMs>0?this.revealDebounceMs:typeof this.revealDebounceMsOption=="number"&&this.revealDebounceMsOption>0?this.revealDebounceMsOption:this.revealDebounceMs;this.revealDebounceId=setTimeout(()=>{this.revealDebounceId=null;const r=++this.revealTicket;this.dlog("scheduled debounce reveal ticket=",r,"line=",l,"ms=",n),this.performReveal(l,r)},n)})}performReveal(e,t){this.rafScheduler.schedule("reveal",()=>{var i;if(t!==this.revealTicket){this.dlog("performReveal skipped, stale ticket",t,"current",this.revealTicket);return}this.dlog("performReveal executing, ticket=",t,"line=",e);const l=this.revealStrategyOption??this.options.revealStrategy??"centerIfOutside";this.dlog("performReveal strategy=",l);const o=h.ScrollType||((i=h.editor)===null||i===void 0?void 0:i.ScrollType),n=o&&typeof o.Smooth<"u"?o.Smooth:void 0;try{l==="bottom"?typeof n<"u"?this.editorView.revealLine(e,n):this.editorView.revealLine(e):l==="center"?typeof n<"u"?this.editorView.revealLineInCenter(e,n):this.editorView.revealLineInCenter(e):typeof n<"u"?this.editorView.revealLineInCenterIfOutsideViewport(e,n):this.editorView.revealLineInCenterIfOutsideViewport(e)}catch{try{this.editorView.revealLine(e)}catch{}}})}performImmediateReveal(e,t){this.dlog("performImmediateReveal line=",e,"ticket=",t);try{var i;if(!this.editorView)return;if(t!==this.revealTicket){this.dlog("performImmediateReveal skipped, stale ticket",t,"current",this.revealTicket);return}const l=h.ScrollType||((i=h.editor)===null||i===void 0?void 0:i.ScrollType),o=l&&typeof l.Immediate<"u"?l.Immediate:void 0;typeof o<"u"?this.editorView.revealLine(e,o):this.editorView.revealLine(e)}catch{}try{this.measureViewport()}catch{}}forceReveal(e){try{var t;if(!this.editorView)return;const o=h.ScrollType||((t=h.editor)===null||t===void 0?void 0:t.ScrollType),n=o&&typeof o.Immediate<"u"?o.Immediate:void 0;typeof n<"u"?this.editorView.revealLine(e,n):this.editorView.revealLine(e)}catch{}try{this.measureViewport()}catch{}try{var i,l;this.shouldAutoScroll=!0,this.lastScrollTop=((i=this.editorView)===null||i===void 0||(l=i.getScrollTop)===null||l===void 0?void 0:l.call(i))??this.lastScrollTop}catch{}}isOverflowAuto(){try{return!!this.lastContainer&&this.lastContainer.style.overflow==="auto"}catch{return!1}}shouldPerformImmediateReveal(){return this.autoScrollOnUpdate&&this.shouldAutoScroll&&this.hasVerticalScrollbar()&&this.isOverflowAuto()}async createEditor(e,t,i,l){var o,n,r,s,a,f,u;if(this.cleanup(),this.lastContainer=e,this.initDebugFlag(),this.dlog("createEditor container, maxHeight",this.maxHeightValue),e.style.overflow="hidden",e.style.maxHeight=this.maxHeightCSS,this.editorView=h.editor.create(e,{value:t,language:k(i)||i,theme:l,scrollBeyondLastLine:!1,minimap:{enabled:!1},automaticLayout:!0,readOnly:this.options.readOnly??!0,contextmenu:!1,scrollbar:{...Ve,...this.options.scrollbar||{}},...this.options}),h.editor.setTheme(l),this.lastKnownCode=this.editorView.getValue(),this.editorHeightManager){try{this.editorHeightManager.dispose()}catch{}this.editorHeightManager=null}this.revealDebounceId!=null&&(clearTimeout(this.revealDebounceId),this.revealDebounceId=null),this.revealIdleTimerId!=null&&clearTimeout(this.revealIdleTimerId),this.revealIdleTimerId=null;const M=Math.min(120,this.maxHeightValue);return e.style.minHeight=`${M}px`,this.editorHeightManager=Be(e,()=>{const S=this.computedHeight(this.editorView),w=Math.min(S,this.maxHeightValue);return Math.max(w,M)}),this.editorHeightManager.update(),this.computedHeight(this.editorView)>=this.maxHeightValue-1&&(e.style.height=`${this.maxHeightValue}px`,e.style.overflow="auto",this.dlog("applied immediate maxHeight on createEditor",this.maxHeightValue)),this.cachedScrollHeight=((o=(n=this.editorView).getScrollHeight)===null||o===void 0?void 0:o.call(n))??null,this.cachedLineHeight=((r=(s=this.editorView).getOption)===null||r===void 0?void 0:r.call(s,h.editor.EditorOption.lineHeight))??null,this.cachedComputedHeight=this.computedHeight(this.editorView),this.cachedLineCount=((a=this.editorView.getModel())===null||a===void 0?void 0:a.getLineCount())??null,(f=(u=this.editorView).onDidContentSizeChange)===null||f===void 0||f.call(u,()=>{this._hasScrollBar=!1,this.rafScheduler.schedule("content-size-change",()=>{try{var S,w,y;this.dlog("content-size-change frame");const D=this.measureViewport();if(this.dlog("content-size-change measure",D),this.cachedLineCount=((S=this.editorView)===null||S===void 0||(S=S.getModel())===null||S===void 0?void 0:S.getLineCount())??this.cachedLineCount,!((w=this.editorHeightManager)===null||w===void 0)&&w.isSuppressed()){this.dlog("content-size-change skipped height update (suppressed)");return}this.dlog("content-size-change calling heightManager.update"),(y=this.editorHeightManager)===null||y===void 0||y.update();const T=this.computedHeight(this.editorView);if(this.lastContainer){const V=this.lastContainer.style.overflow,W=T>=this.maxHeightValue-1?"auto":"hidden";V!==W&&(this.lastContainer.style.overflow=W,W==="auto"&&this.shouldAutoScroll&&this.maybeScrollToBottom())}}catch(D){Le("EditorManager","content-size-change error",D)}})}),this.editorView.onDidChangeModelContent(()=>{this.lastKnownCodeDirty=!0,this.rafScheduler.schedule("sync-last-known",()=>this.syncLastKnownCode())}),this.shouldAutoScroll=!!this.autoScrollInitial,this.scrollWatcher&&(this.scrollWatcher.dispose(),this.scrollWatcher=null),this.scrollWatcher=xe(this.editorView,{onPause:()=>{this.shouldAutoScroll=!1},onMaybeResume:()=>{this.rafScheduler.schedule("maybe-resume",()=>{this.shouldAutoScroll=this.userIsNearBottom()})},getLast:()=>this.lastScrollTop,setLast:S=>{this.lastScrollTop=S}}),this.maybeScrollToBottom(),this.editorView}syncLastKnownCode(){if(!this.editorView||!this.lastKnownCodeDirty)return;const e=this.editorView.getModel();e&&(this.lastKnownCode=e.getValue(),this.cachedLineCount=e.getLineCount()??this.cachedLineCount),this.lastKnownCodeDirty=!1}suppressScrollWatcher(e){!this.scrollWatcher||typeof this.scrollWatcher.setSuppressed!="function"||(this.dlog("suppressScrollWatcher",e),this.scrollWatcherSuppressionTimer!=null&&(clearTimeout(this.scrollWatcherSuppressionTimer),this.scrollWatcherSuppressionTimer=null),this.scrollWatcher.setSuppressed(!0),this.scrollWatcherSuppressionTimer=setTimeout(()=>{this.scrollWatcher&&typeof this.scrollWatcher.setSuppressed=="function"&&(this.scrollWatcher.setSuppressed(!1),this.dlog("suppressScrollWatcher cleared")),this.scrollWatcherSuppressionTimer=null},e))}scheduleImmediateRevealAfterLayout(e){const t=++this.revealTicket;this.dlog("scheduleImmediateRevealAfterLayout ticket=",t,"line=",e),this.rafScheduler.schedule("immediate-reveal",async()=>{try{const i=this.editorView&&this.editorHeightManager?Math.min(this.computedHeight(this.editorView),this.maxHeightValue):-1;i!==-1&&this.editorHeightManager?await this.waitForHeightApplied(i,500):await new Promise(l=>requestAnimationFrame(()=>requestAnimationFrame(()=>l()))),this.dlog("running delayed immediate reveal","ticket=",t,"line=",e),this.performImmediateReveal(e,t)}catch(i){Le("EditorManager","scheduleImmediateRevealAfterLayout error",i)}})}waitForHeightApplied(e,t=500){return new Promise(i=>{const l=typeof performance<"u"&&performance.now?performance.now():Date.now(),o=()=>{try{var n,r;const s=((n=this.editorHeightManager)===null||n===void 0||(r=n.getLastApplied)===null||r===void 0?void 0:r.call(n))??-1;if(s!==-1&&Math.abs(s-e)<=12){this.dlog("waitForHeightApplied satisfied",s,"target=",e),i();return}if((typeof performance<"u"&&performance.now?performance.now():Date.now())-l>t){L("EditorManager","waitForHeightApplied timeout",s,"target=",e),i();return}}catch{}requestAnimationFrame(o)};o()})}updateCode(e,t){this.pendingUpdate={code:e,lang:t},this.rafScheduler.schedule("update",()=>this.flushPendingUpdate())}flushPendingUpdate(){if(!this.pendingUpdate||!this.editorView)return;const e=this.editorView.getModel();if(!e)return;const{code:t,lang:i}=this.pendingUpdate;this.pendingUpdate=null;const l=k(i);if(e.getLanguageId()!==l){l&&h.editor.setModelLanguage(e,l);const f=e.getLineCount();e.setValue(t),this.lastKnownCode=t;const u=e.getLineCount();this.cachedLineCount=u,u!==f&&(this.shouldPerformImmediateReveal()&&this.suppressScrollWatcher(this.scrollWatcherSuppressionMs),this.computedHeight(this.editorView)>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`),this.forceReveal(u));return}const n=this.appendBuffer.length>0?this.appendBuffer.join(""):"",r=this.appendBuffer.length>0?this.editorView.getValue()+n:this.lastKnownCode??this.editorView.getValue();if(r===t)return;if(t.startsWith(r)&&r.length<t.length){const f=t.slice(r.length);f&&this.appendCode(f,i),this.lastKnownCode=t;return}const s=e.getLineCount();this.applyMinimalEdit(r,t),this.lastKnownCode=t;const a=e.getLineCount();if(this.cachedLineCount=a,a!==s){const f=this.shouldPerformImmediateReveal();f&&this.suppressScrollWatcher(this.scrollWatcherSuppressionMs),f?this.scheduleImmediateRevealAfterLayout(a):this.maybeScrollToBottom(a)}}appendCode(e,t){if(!this.editorView)return;const i=this.editorView.getModel();if(!i)return;const l=t?k(t):i.getLanguageId();l&&i.getLanguageId()!==l&&h.editor.setModelLanguage(i,l),e&&(this.appendBuffer.push(e),this.appendBufferScheduled||(this.appendBufferScheduled=!0,this.rafScheduler.schedule("append",()=>this.flushAppendBuffer())))}applyMinimalEdit(e,t){if(!this.editorView)return;const i=this.editorView.getModel();if(!i)return;const l=he,o=ce,n=Math.max(e.length,t.length),r=n>0?Math.abs(t.length-e.length)/n:0;if(e.length+t.length>l||r>o){const D=i.getLineCount();i.setValue(t),this.lastKnownCode=t;const T=i.getLineCount();this.cachedLineCount=T,T!==D&&this.maybeScrollToBottom(T);return}const s=fe(e,t);if(!s)return;const{start:a,endPrevIncl:f,replaceText:u}=s,M=i.getPositionAt(a),p=i.getPositionAt(f+1),S=new h.Range(M.lineNumber,M.column,p.lineNumber,p.column),w=this.editorView.getOption(h.editor.EditorOption.readOnly),y=[{range:S,text:u,forceMoveMarkers:!0}];w?i.applyEdits(y):this.editorView.executeEdits("minimal-replace",y)}flushAppendBuffer(){if(!this.editorView||this.appendBuffer.length===0)return;this.appendBufferScheduled=!1;const e=this.editorView.getModel();if(!e){this.appendBuffer.length=0;return}const t=this.appendBuffer.join("");this.appendBuffer.length=0;const i=e.getLineCount(),l=e.getLineMaxColumn(i),o=new h.Range(i,l,i,l);this.editorView.getOption(h.editor.EditorOption.readOnly)?e.applyEdits([{range:o,text:t,forceMoveMarkers:!0}]):this.editorView.executeEdits("append",[{range:o,text:t,forceMoveMarkers:!0}]);try{this.lastKnownCode=e.getValue()}catch{}const r=e.getLineCount();if(i!==r){this.cachedLineCount=r;const s=this.shouldPerformImmediateReveal();if(s&&this.suppressScrollWatcher(this.scrollWatcherSuppressionMs),this.computedHeight(this.editorView)>=this.maxHeightValue-1&&this.lastContainer&&(this.lastContainer.style.height=`${this.maxHeightValue}px`),s)try{this.forceReveal(r)}catch{}else this.maybeScrollToBottom(r)}}setLanguage(e,t){if(t.includes(e)){if(this.editorView){const i=this.editorView.getModel();i&&i.getLanguageId()!==e&&h.editor.setModelLanguage(i,e)}}else console.warn(`Language "${e}" is not registered. Available languages: ${t.join(", ")}`)}getEditorView(){return this.editorView}cleanup(){this.rafScheduler.cancel("update"),this.rafScheduler.cancel("sync-last-known"),this.rafScheduler.cancel("content-size-change"),this.rafScheduler.cancel("maybe-scroll"),this.rafScheduler.cancel("reveal"),this.rafScheduler.cancel("immediate-reveal"),this.rafScheduler.cancel("maybe-resume"),this.pendingUpdate=null,this.rafScheduler.cancel("append"),this.appendBufferScheduled=!1,this.appendBuffer.length=0,this.revealDebounceId!=null&&(clearTimeout(this.revealDebounceId),this.revealDebounceId=null),this.revealIdleTimerId!=null&&(clearTimeout(this.revealIdleTimerId),this.revealIdleTimerId=null),this.scrollWatcherSuppressionTimer!=null&&(clearTimeout(this.scrollWatcherSuppressionTimer),this.scrollWatcherSuppressionTimer=null),this.editorView&&(this.editorView.dispose(),this.editorView=null),this.lastKnownCode=null,this.lastContainer&&(this.lastContainer.style.minHeight="",this.lastContainer.innerHTML="",this.lastContainer=null),this.scrollWatcher&&(this.scrollWatcher.dispose(),this.scrollWatcher=null),this.editorHeightManager&&(this.editorHeightManager.dispose(),this.editorHeightManager=null)}safeClean(){if(this.rafScheduler.cancel("update"),this.pendingUpdate=null,this.rafScheduler.cancel("sync-last-known"),this.scrollWatcher){try{this.scrollWatcher.dispose()}catch{}this.scrollWatcher=null}this.revealDebounceId!=null&&(clearTimeout(this.revealDebounceId),this.revealDebounceId=null),this.revealIdleTimerId!=null&&(clearTimeout(this.revealIdleTimerId),this.revealIdleTimerId=null),this.scrollWatcherSuppressionTimer!=null&&(clearTimeout(this.scrollWatcherSuppressionTimer),this.scrollWatcherSuppressionTimer=null),this.rafScheduler.cancel("maybe-scroll"),this.rafScheduler.cancel("reveal"),this.rafScheduler.cancel("immediate-reveal"),this.rafScheduler.cancel("maybe-resume"),this._hasScrollBar=!1,this.shouldAutoScroll=!!this.autoScrollInitial,this.lastScrollTop=0,this.editorHeightManager&&(this.editorHeightManager.dispose(),this.editorHeightManager=null)}};function St(e){const t=lt(e);return Object.defineProperty({},"value",{get(){return t()},set(i){t(i)},enumerable:!0,configurable:!1})}function Mt(e){const t=ot(()=>e());return Object.defineProperty({},"value",{get(){return t()},set(i){},enumerable:!0,configurable:!1})}function ye(e,t,i={}){let l=!1,o;return nt(()=>{const r=e();l?Object.is(r,o)||(i.flush==="post"?queueMicrotask(()=>t(r,o)):t(r,o)):(l=!0,i.immediate&&(i.flush==="post"?queueMicrotask(()=>t(r,o)):t(r,o))),o=r})}const te=St(!1);function wt(){var e,t,i;if(typeof window>"u"||typeof document>"u")return!1;const o=((e=document.documentElement.classList)===null||e===void 0?void 0:e.contains("dark"))??!1,n=(t=(i=window).matchMedia)===null||t===void 0?void 0:t.call(i,"(prefers-color-scheme: dark)"),r=!!(n!=null&&n.matches);return o||r}if(typeof window<"u"&&typeof document<"u"){var ae,Ce;const e=document.documentElement,t=(ae=(Ce=window).matchMedia)===null||ae===void 0?void 0:ae.call(Ce,"(prefers-color-scheme: dark)"),i=()=>{te.value=wt()};i();const l=()=>i();t&&(t.addEventListener?t.addEventListener("change",l):t.addListener(l));const o=new MutationObserver(i);o.observe(e,{attributes:!0,attributeFilter:["class"]});const n=()=>{t&&(t.removeEventListener?t.removeEventListener("change",l):t.removeListener(l)),o.disconnect(),window.removeEventListener("pagehide",n),window.removeEventListener("beforeunload",n)};window.addEventListener("pagehide",n),window.addEventListener("beforeunload",n)}async function qt(){if(typeof window>"u"||typeof document>"u")return;const e=new URL(""+new URL("json.worker-BdzgVb0v.js",import.meta.url).href,import.meta.url),t=new URL(""+new URL("css.worker-WS04UMDh.js",import.meta.url).href,import.meta.url),i=new URL(""+new URL("html.worker-CgShHVgd.js",import.meta.url).href,import.meta.url),l=new URL(""+new URL("ts.worker-7CkXc5qG.js",import.meta.url).href,import.meta.url),o=new URL("data:text/javascript;base64,LyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KICogIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLgogKiAgTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLiBTZWUgTGljZW5zZS50eHQgaW4gdGhlIHByb2plY3Qgcm9vdCBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4KICotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovCmltcG9ydCB7IFNpbXBsZVdvcmtlclNlcnZlciB9IGZyb20gJy4uL2Jhc2UvY29tbW9uL3dvcmtlci9zaW1wbGVXb3JrZXIuanMnOwppbXBvcnQgeyBFZGl0b3JTaW1wbGVXb3JrZXIgfSBmcm9tICcuL2NvbW1vbi9zZXJ2aWNlcy9lZGl0b3JTaW1wbGVXb3JrZXIuanMnOwppbXBvcnQgeyBFZGl0b3JXb3JrZXJIb3N0IH0gZnJvbSAnLi9jb21tb24vc2VydmljZXMvZWRpdG9yV29ya2VySG9zdC5qcyc7CmxldCBpbml0aWFsaXplZCA9IGZhbHNlOwpleHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZShmb3JlaWduTW9kdWxlKSB7CiAgICBpZiAoaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBpbml0aWFsaXplZCA9IHRydWU7CiAgICBjb25zdCBzaW1wbGVXb3JrZXIgPSBuZXcgU2ltcGxlV29ya2VyU2VydmVyKChtc2cpID0+IHsKICAgICAgICBnbG9iYWxUaGlzLnBvc3RNZXNzYWdlKG1zZyk7CiAgICB9LCAod29ya2VyU2VydmVyKSA9PiBuZXcgRWRpdG9yU2ltcGxlV29ya2VyKEVkaXRvcldvcmtlckhvc3QuZ2V0Q2hhbm5lbCh3b3JrZXJTZXJ2ZXIpLCBmb3JlaWduTW9kdWxlKSk7CiAgICBnbG9iYWxUaGlzLm9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgc2ltcGxlV29ya2VyLm9ubWVzc2FnZShlLmRhdGEpOwogICAgfTsKfQpnbG9iYWxUaGlzLm9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAvLyBJZ25vcmUgZmlyc3QgbWVzc2FnZSBpbiB0aGlzIGNhc2UgYW5kIGluaXRpYWxpemUgaWYgbm90IHlldCBpbml0aWFsaXplZAogICAgaWYgKCFpbml0aWFsaXplZCkgewogICAgICAgIGluaXRpYWxpemUobnVsbCk7CiAgICB9Cn07Cg==",import.meta.url),n=Array.from(new Set([String(e),String(t),String(i),String(l),String(o)])),r={json:e,css:t,scss:t,less:t,html:i,handlebars:i,razor:i,typescript:l,javascript:l};try{await Promise.all(n.map(s=>fetch(s,{method:"GET",cache:"force-cache"}).catch(()=>{}))),self.MonacoEnvironment={getWorker(s,a){const f=r[a]??o;return new Worker(f,{type:"module"})}}}catch{}}function de(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}let De=!1,Te=!1,be=[],ie=[];const U=new Map;function Jt(){U.clear()}function Oe(e){return JSON.stringify(e.map(t=>typeof t=="string"?t:t.name??JSON.stringify(t)).sort())}async function Lt(e,t){const i=Oe(e),l=new Set(t);let o=U.get(i);if(o){let s=!0;for(const w of l)if(!o.languages.has(w)){s=!1;break}if(s)return o.promise;const a=o,f=U.get(i);if(f&&f!==a){let w=!0;for(const y of l)if(!f.languages.has(y)){w=!1;break}if(w)return f.promise;o=f}const u=new Set([...o.languages,...l]),M=Array.from(u),p=Se({themes:e,langs:M}),S={promise:p,languages:u};return U.set(i,S),p.catch(()=>{U.get(i)===S&&a&&U.set(i,a)}),p}const n=Se({themes:e,langs:Array.from(l)}),r={promise:n,languages:l};return U.set(i,r),n.catch(()=>{U.get(i)===r&&U.delete(i)}),n}async function Q(e,t){if(yt(t),De&&de(e,be)&&de(t,ie)){const l=U.get(Oe(e));return l?l.promise:Promise.resolve(null)}const i=(async()=>{const l=await Lt(e,t);return rt(l,h),De=!0,be=e,ie=t,l})();try{return await i}catch(l){throw l}}function yt(e){if(Te&&de(e,ie))return;const t=new Set(h.languages.getLanguages().map(i=>i.id));for(const i of e)if(!t.has(i))try{h.languages.register({id:i})}catch{}Te=!0,ie=e}let Yt=(function(e){return e.Bottom="bottom",e.CenterIfOutside="centerIfOutside",e.Center="center",e})({});function Qt(e={}){var t;const i=[];(e.isCleanOnBeforeCreate??!0)&&i.forEach(d=>d.dispose()),(e.isCleanOnBeforeCreate??!0)&&(i.length=0);let l=null,o=null,n=null,r=null,s=null,a=null,f=!1;const u=e.themes&&(!((t=e.themes)===null||t===void 0)&&t.length)?e.themes:gt;if(!Array.isArray(u)||u.length<2)throw new Error("Monaco themes must be an array with at least two themes: [darkTheme, lightTheme]");const M=e.languages??ut,p=e.MAX_HEIGHT??500,S=e.autoScrollOnUpdate??!0,w=e.autoScrollInitial??!0,y=e.autoScrollThresholdPx??32,D=e.autoScrollThresholdLines??2,T=e.diffAutoScroll??!0,V=()=>{if(typeof p=="number")return p;const d=p.match(/^(\d+(?:\.\d+)?)/);return d?Number.parseFloat(d[1]):500},W=()=>typeof p=="number"?`${p}px`:p,B=V(),K=W();let I=null,b=null;const A=e.minimalEditMaxChars??he,x=e.minimalEditMaxChangeRatio??ce;let O=e.updateThrottleMs??50,_=0,G=null,P=null,ge=!0;const N=[];let ee=!1,z=null;const $=Mt(()=>e.theme??(te.value?typeof u[0]=="string"?u[0]:u[0].name:typeof u[1]=="string"?u[1]:u[1].name));let X=null;const Z=ue();async function le(d,c=!1){const m=typeof d=="string"?d:d.name;if(!c&&m===z)return;const C=Q(u,M);C&&await C.catch(()=>{});const v=u.map(E=>typeof E=="string"?E:E.name);if(!v.includes(m))try{const E=v.concat(m),H=await Q(E,M);if(H&&typeof H.setTheme=="function")try{await H.setTheme(m)}catch{}}catch{console.warn(`Theme "${m}" is not registered and automatic registration failed. Available themes: ${v.join(", ")}`);return}try{h.editor.setTheme(m),z=m}catch{try{const E=await Q(u,M);h.editor.setTheme(m),z=m,E&&typeof E.setTheme=="function"&&await E.setTheme(m).catch(()=>{})}catch(E){console.warn(`Failed to set theme "${m}":`,E);return}}try{typeof e.onThemeChange=="function"&&await e.onThemeChange(m)}catch(E){console.warn("onThemeChange callback threw an error:",E)}}function Re(){if(!l)return!1;if(f)return!0;const d=Ue(l);return f=l.getScrollHeight()>d+F/2}let q=null;const ke=75;function j(d){if(S&&ge&&Re()){const c=l.getModel(),m=d??(c==null?void 0:c.getLineCount())??1;q!=null&&(clearTimeout(q),q=null),q=setTimeout(()=>{q=null,Z.schedule("reveal",()=>{try{var C;const v=h.ScrollType||((C=h.editor)===null||C===void 0?void 0:C.ScrollType);v&&typeof v.Smooth<"u"?l.revealLineInCenterIfOutsideViewport(m,v.Smooth):l.revealLineInCenterIfOutsideViewport(m)}catch{}})},ke)}}async function Ke(d,c,m){if(oe(),I=d,(e.isCleanOnBeforeCreate??!0)&&(i.forEach(v=>v.dispose()),i.length=0),e.onBeforeCreate){const v=e.onBeforeCreate(h);v&&i.push(...v)}await Q(u,M);const C=e.theme??$.value;return z=C,o=new vt(e,B,K,S,w,y,D,e.revealDebounceMs),l=await o.createEditor(d,c,m,C),typeof e.onThemeChange=="function"&&e.onThemeChange(C),e.theme||(X=ye(()=>te.value,()=>{const v=$.value;v!==z&&le(v)},{flush:"post",immediate:!0})),l&&(b=l.getValue()),l}function Ue(d){var c;const m=((c=d.getModel())===null||c===void 0?void 0:c.getLineCount())??1,C=d.getOption(h.editor.EditorOption.lineHeight);return Math.min(m*C+F,B)}async function Pe(d,c,m,C){if(oe(),I=d,(e.isCleanOnBeforeCreate??!0)&&(i.forEach(H=>H.dispose()),i.length=0),e.onBeforeCreate){const H=e.onBeforeCreate(h);H&&i.push(...H)}await Q(u,M);const v=e.theme??$.value;try{h.editor.setTheme(v),z=v}catch{}r=new mt(e,B,K,S,w,y,D,T,e.revealDebounceMs),n=await r.createDiffEditor(d,c,m,C,v),typeof e.onThemeChange=="function"&&e.onThemeChange(v),e.theme||(X=ye(()=>te.value,()=>{const H=$.value;H!==z&&le(H)},{flush:"post",immediate:!0}));const E=r.getDiffModels();return s=E.original,a=E.modified,n}function oe(){o&&(o.cleanup(),o=null),r&&(r.cleanup(),r=null),Z.cancel("update"),P=null,Z.cancel("append"),ee=!1,N.length=0,!o&&l&&(l.dispose(),l=null),b=null,I&&(I.innerHTML="",I=null),X&&(X(),X=null),G!=null&&(clearTimeout(G),G=null),n=null,s=null,a=null}function pe(d,c){if(o)o.appendCode(d,c);else{if(!l)return;const m=l.getModel();if(!m)return;const C=c?k(c):m.getLanguageId();C&&m.getLanguageId()!==C&&h.editor.setModelLanguage(m,C),d&&b!=null&&(b=b+d),d&&(N.push(d),ee||(ee=!0,Z.schedule("append",Ne)))}}function Ge(d,c){if(!l)return;const m=l.getModel();if(!m)return;try{const Je=A,Ye=x,me=Math.max(d.length,c.length),Qe=me>0?Math.abs(c.length-d.length)/me:0;if(d.length+c.length>Je||Qe>Ye){const et=m.getLineCount();m.setValue(c),b=c;const ve=m.getLineCount();ve!==et&&j(ve);return}}catch{}const C=fe(d,c);if(!C)return;const{start:v,endPrevIncl:E,replaceText:H}=C,R=m.getPositionAt(v),J=m.getPositionAt(E+1),re=new h.Range(R.lineNumber,R.column,J.lineNumber,J.column),se=l.getOption(h.editor.EditorOption.readOnly),Y=[{range:re,text:H,forceMoveMarkers:!0}];se?m.applyEdits(Y):l.executeEdits("minimal-replace",Y)}function ne(){if(!P||(_=Date.now(),!l))return;const d=l.getModel();if(!d)return;const{code:c,lang:m}=P;P=null;const C=k(m);let v=null;if(N.length>0)try{v=d.getValue(),b=v}catch{v=""}else if(v=b,v==null)try{v=d.getValue(),b=v}catch{v=""}if(v===c)return;if(d.getLanguageId()!==C){C&&h.editor.setModelLanguage(d,C);const H=d.getLineCount();d.setValue(c),b=c;const R=d.getLineCount();R!==H&&j(R);return}if(c.startsWith(v)&&v.length<c.length){const H=c.slice(v.length);H&&pe(H,m),b=c;return}try{const H=A,R=x,J=Math.max(v.length,c.length),re=J>0?Math.abs(c.length-v.length)/J:0;if(v.length+c.length>H||re>R){const se=d.getLineCount();d.setValue(c),b=c;const Y=d.getLineCount();Y!==se&&j(Y);return}}catch{}try{Ge(v,c),b=c;const H=d.getLineCount(),R=(v?v.split(`
`).length:0)||d.getLineCount();H!==R&&j(H)}catch{try{const H=d.getLineCount();d.setValue(c),b=c;const R=d.getLineCount();R!==H&&j(R)}catch{}}}function Ne(){if(!l||N.length===0)return;ee=!1;const d=l.getModel();if(!d){N.length=0;return}const c=N.join("");N.length=0;try{const m=d.getLineCount(),C=d.getLineMaxColumn(m),v=new h.Range(m,C,m,C);l.getOption(h.editor.EditorOption.readOnly)?d.applyEdits([{range:v,text:c,forceMoveMarkers:!0}]):l.executeEdits("append",[{range:v,text:c,forceMoveMarkers:!0}]),b!=null&&(b=b+c);try{m!==d.getLineCount()&&j(d.getLineCount())}catch{}}catch{}}function ze(d,c){o?o.updateCode(d,c):(P={code:d,lang:c},Z.schedule("update",()=>{if(!O){ne();return}const C=Date.now()-_;if(C>=O){ne();return}if(G!=null)return;const v=O-C;G=setTimeout(()=>{G=null,Z.schedule("update",()=>ne())},v)}))}function Ze(d){O=d}function Fe(){return O}function _e(d,c,m){r&&r.updateDiff(d,c,m)}function je(d,c){r&&r.updateOriginal(d,c)}function $e(d,c){r&&r.updateModified(d,c)}function Xe(d,c){r&&r.appendOriginal(d,c)}function qe(d,c){r&&r.appendModified(d,c)}return{createEditor:Ke,createDiffEditor:Pe,cleanupEditor:oe,safeClean(){if(Z.cancel("update"),P=null,o)try{o.safeClean()}catch{}if(r)try{r.safeClean()}catch{}f=!1,ge=!!w},updateCode:ze,appendCode:pe,updateDiff:_e,updateOriginal:je,updateModified:$e,appendOriginal:Xe,appendModified:qe,setTheme:le,setLanguage(d){if(o){o.setLanguage(d,M);return}if(r){r.setLanguage(d,M);return}if(M.includes(d)){if(l){const c=l.getModel();c&&c.getLanguageId()!==d&&h.editor.setModelLanguage(c,d)}s&&s.getLanguageId()!==d&&h.editor.setModelLanguage(s,d),a&&a.getLanguageId()!==d&&h.editor.setModelLanguage(a,d)}else console.warn(`Language "${d}" is not registered. Available languages: ${M.join(", ")}`)},getCurrentTheme(){return $.value},getEditor(){return h.editor},getEditorView(){return l},getDiffEditorView(){return n},getDiffModels(){return{original:s,modified:a}},getMonacoInstance(){return h},setUpdateThrottleMs:Ze,getUpdateThrottleMs:Fe,getCode(){if(l)try{var d;return((d=l.getModel())===null||d===void 0?void 0:d.getValue())??null}catch{return null}if(n||s&&a)try{const c=(s==null?void 0:s.getValue())??"",m=(a==null?void 0:a.getValue())??"";return{original:c,modified:m}}catch{return null}return null}}}export{Yt as RevealStrategy,Jt as clearHighlighterCache,Ee as defaultRevealDebounceMs,Xt as detectLanguage,Lt as getOrCreateHighlighter,te as isDark,qt as preloadMonacoWorkers,Q as registerMonacoThemes,Qt as useMonaco};
