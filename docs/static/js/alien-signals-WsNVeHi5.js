var m;(function(e){e[e.None=0]="None",e[e.Mutable=1]="Mutable",e[e.Watching=2]="Watching",e[e.RecursedCheck=4]="RecursedCheck",e[e.Recursed=8]="Recursed",e[e.Dirty=16]="Dirty",e[e.Pending=32]="Pending"})(m||(m={}));function B({update:e,notify:t,unwatched:r}){let l=0;return{link:b,unlink:T,propagate:W,checkDirty:z,endTracking:j,startTracking:I,shallowPropagate:g};function b(n,i){const s=i.depsTail;if(s!==void 0&&s.dep===n)return;const f=s!==void 0?s.nextDep:i.deps;if(f!==void 0&&f.dep===n){f.version=l,i.depsTail=f;return}const u=n.subsTail;if(u!==void 0&&u.version===l&&u.sub===i)return;const d=i.depsTail=n.subsTail={version:l,dep:n,sub:i,prevDep:s,nextDep:f,prevSub:u,nextSub:void 0};f!==void 0&&(f.prevDep=d),s!==void 0?s.nextDep=d:i.deps=d,u!==void 0?u.nextSub=d:n.subs=d}function T(n,i=n.sub){const s=n.dep,f=n.prevDep,u=n.nextDep,d=n.nextSub,o=n.prevSub;return u!==void 0?u.prevDep=f:i.depsTail=f,f!==void 0?f.nextDep=u:i.deps=u,d!==void 0?d.prevSub=o:s.subsTail=o,o!==void 0?o.nextSub=d:(s.subs=d)===void 0&&r(s),u}function W(n){let i=n.nextSub,s;e:do{const f=n.sub;let u=f.flags;if(u&60?u&12?u&4?!(u&48)&&A(n,f)?(f.flags=u|40,u&=1):u=0:f.flags=u&-9|32:u=0:f.flags=u|32,u&2&&t(f),u&1){const d=f.subs;if(d!==void 0){const o=(n=d).nextSub;o!==void 0&&(s={value:i,prev:s},i=o);continue}}if((n=i)!==void 0){i=n.nextSub;continue}for(;s!==void 0;)if(n=s.value,s=s.prev,n!==void 0){i=n.nextSub;continue e}break}while(!0)}function I(n){++l,n.depsTail=void 0,n.flags=n.flags&-57|4}function j(n){const i=n.depsTail;let s=i!==void 0?i.nextDep:n.deps;for(;s!==void 0;)s=T(s,n);n.flags&=-5}function z(n,i){let s,f=0,u=!1;e:do{const d=n.dep,o=d.flags;if(i.flags&16)u=!0;else if((o&17)===17){if(e(d)){const c=d.subs;c.nextSub!==void 0&&g(c),u=!0}}else if((o&33)===33){(n.nextSub!==void 0||n.prevSub!==void 0)&&(s={value:n,prev:s}),n=d.deps,i=d,++f;continue}if(!u){const c=n.nextDep;if(c!==void 0){n=c;continue}}for(;f--;){const c=i.subs,w=c.nextSub!==void 0;if(w?(n=s.value,s=s.prev):n=c,u){if(e(i)){w&&g(c),i=n.sub;continue}u=!1}else i.flags&=-33;i=n.sub;const y=n.nextDep;if(y!==void 0){n=y;continue e}}return u}while(!0)}function g(n){do{const i=n.sub,s=i.flags;(s&48)===32&&(i.flags=s|16,s&2&&t(i))}while((n=n.nextSub)!==void 0)}function A(n,i){let s=i.depsTail;for(;s!==void 0;){if(s===n)return!0;s=s.prevDep}return!1}}const v=[],{link:D,unlink:x,propagate:G,checkDirty:V,endTracking:C,startTracking:P,shallowPropagate:L}=B({update(e){return"getter"in e?M(e):O(e,e.value)},notify:q,unwatched(e){if("getter"in e){let t=e.deps;if(t!==void 0){e.flags=17;do t=x(t,e);while(t!==void 0)}}else"previousValue"in e||N.call(e)}});let h=0,S=0,p;function a(e){const t=p;return p=e,t}function Q(e){return K.bind({previousValue:e,value:e,subs:void 0,subsTail:void 0,flags:1})}function U(e){return J.bind({value:void 0,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:17,getter:e})}function X(e){const t={fn:e,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};p!==void 0&&D(t,p);const r=a(t);try{t.fn()}finally{a(r)}return N.bind(t)}function M(e){const t=a(e);P(e);try{const r=e.value;return r!==(e.value=e.getter(r))}finally{a(t),C(e)}}function O(e,t){return e.flags=1,e.previousValue!==(e.previousValue=t)}function q(e){const t=e.flags;if(!(t&64)){e.flags=t|64;const r=e.subs;r!==void 0?q(r.sub):v[S++]=e}}function E(e,t){if(t&16||t&32&&V(e.deps,e)){const l=a(e);P(e);try{e.fn()}finally{a(l),C(e)}return}else t&32&&(e.flags=t&-33);let r=e.deps;for(;r!==void 0;){const l=r.dep,b=l.flags;b&64&&E(l,l.flags=b&-65),r=r.nextDep}}function H(){for(;h<S;){const e=v[h];v[h++]=void 0,E(e,e.flags&=-65)}h=0,S=0}function J(){const e=this.flags;if(e&16||e&32&&V(this.deps,this)){if(M(this)){const t=this.subs;t!==void 0&&L(t)}}else e&32&&(this.flags=e&-33);return p!==void 0&&D(this,p),this.value}function K(...e){if(e.length){if(this.value!==(this.value=e[0])){this.flags=17;const t=this.subs;t!==void 0&&(G(t),H())}}else{const t=this.value;if(this.flags&16&&O(this,t)){const r=this.subs;r!==void 0&&L(r)}return p!==void 0&&D(this,p),t}}function N(){let e=this.deps;for(;e!==void 0;)e=x(e,this);const t=this.subs;t!==void 0&&x(t),this.flags=0}export{U as c,X as e,Q as s};
